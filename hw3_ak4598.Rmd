---
title: "HW3 by AK4598"
author: "Aleya Khalifa"
date: "`r Sys.Date()`"
output: github_document
---

```{r setup, include=FALSE}
knitr::opts_chunk$set(echo = TRUE)
library(tidyverse)
library(p8105.datasets)

knitr::opts_chunk$set(
  fig.width = 6,
  fig.asp = .6,
  out.width = "90%"
)

theme_set(theme_bw() + theme(legend.position = "bottom"))

options(
  ggplot2.continuous.colour = "viridis",
  ggplot2.continuous.fill = "viridis"
)

scale_colour_discrete = scale_colour_viridis_d
scale_fill_discrete = scale_fill_viridis_d
```

# Problem 1

We will explore the `instacart` dataset in this problem. These anonymized data entail grocery orders from Instacart app users. 

```{r, include = FALSE}
data("instacart")
```

The `instacart` dataset has `r format(nrow(instacart),scientific=FALSE, big.mark=",")` observations and `r ncol(instacart)` variables. Some important identification variables include `order_id`, `user_id`, and `product_id` - which help to organize the data by app users, their orders, and the items they ordered. `product_name` includes the names of the products ordered, and `order_hour_of_day` shows the hour of the day when the user placed the order.

For example, user 112108 reordered "Bulgarian Yoghurt" as part of an order that also included celery and cucumbers. Another user (206209) put in an order at 2pm about 30 days after their prior order, and this contained bananas, pepsi, dark chocolate, and ice cream.

## Problem 1.1

How many aisles are there, and which aisles are the most items ordered from? 

There are `r instacart %>% group_by(aisle_id) %>% summarize(n = n()) %>% nrow()` unique types of aisles. 

```{r}
instacart %>% 
  group_by(aisle_id) %>% 
  summarize(n = n()) %>% 
  nrow()
```

The two aisles from which the most items are ordered from are fresh vegetables and fresh fruits.

```{r}
instacart %>% 
  group_by(aisle) %>%
  summarize(n = n()) %>% 
  filter(min_rank(desc(n)) < 3)
```


## Problem 1.2

First, create the dataset for a plot that shows the number of items ordered in each aisle. The data will be limited to those aisles with more than 10,000 items ordered. 

```{r}
plot_items <- instacart %>%
  group_by(aisle) %>%
  summarize(n = n()) %>%
  filter(n > 10000) %>%
  arrange(desc(n))
```

Then, plot the number of items ordered in each aisle.

```{r plot_items, warning = FALSE, message = FALSE}
ggplot(plot_items, aes(x = reorder(aisle, -n), y = n)) + 
  geom_histogram(stat = "identity") + 
  labs(
    title = "Number of items ordered per aisle",
    x = "Aisle",
    y = "Number of items",
  ) + 
  theme_bw() + 
  theme(axis.text.x = element_text(angle = 90))
```

## Problem 1.3

This is a table showing the three most popular items in each of the aisles, "baking ingredients", "dog food care", and "packaged vegetables fruits". It shows the number of times each item is ordered in your table.

```{r table_aisles}
instacart %>%
  filter(aisle == "baking ingredients" | 
           aisle == "dog food care" | 
           aisle == "packaged vegetables fruits") %>%
  group_by(aisle, product_name) %>%
    summarize(num_orders = n()) %>%
  mutate(rank = min_rank(desc(num_orders))) %>%
  filter(rank < 4) %>%
  select(-rank)
```

## Problem 1.4

This is a table showing the mean hour of the day at which Pink Lady Apples and Coffee Ice Cream were ordered by day of the week.

```{r table_orders}
instacart %>% 
  filter(product_name == "Pink Lady Apples" | 
           product_name == "Coffee Ice Cream") %>%
  group_by(product_name, order_dow) %>%
  summarize(mean_hour = mean(order_hour_of_day)) %>%
  mutate(day = case_when(
    order_dow == 0 ~ "Sunday",
    order_dow == 1 ~ "Monday",
    order_dow == 2 ~ "Tuesday",
    order_dow == 3 ~ "Wednesday",
    order_dow == 4 ~ "Thursday",
    order_dow == 5 ~ "Friday",
    order_dow == 6 ~ "Saturday",
  )) %>%
  select(product_name, day, mean_hour)
```

# Problem 2

We will use BRFSS data (`brfss_smart2010`) in this problem.

```{r, include = FALSE}
data("brfss_smart2010")
```

## Clean the data:

-   Format the data to use appropriate variable names

-   Focus on the "Overall Health" topic

-   Include only responses from "Excellent" to "Poor"

-   Organize responses as a factor taking levels ordered from "Poor" to "Excellent"

```{r}
brfss_smart2010 <- brfss_smart2010 %>%
  janitor::clean_names() %>%
  filter(topic == "Overall Health") %>%
  mutate(response = factor(response, 
                           ordered = TRUE,
                           levels = c("Poor", "Fair", "Good", "Very good", "Excellent")))
  
```

## Problem 2.1

This table shows which states were observed at 7 or more distinct locations in 2002 and in 2010. Here, I define "location" as the county.

```{r}
brfss_smart2010 %>%
  filter(year == 2002 | year == 2010) %>%
  group_by(locationabbr, year) %>%
  summarize(num_locations = n_distinct(locationdesc)) %>%
  filter(num_locations > 7) %>%
  select(year, locationabbr, num_locations) %>%
  arrange(year, num_locations)
```

You can see that three states were observed at more than 7 distinct locations in 2002: MA, NJ, and PA. Another 11 states were observed for more than 7 distinct locations, as seen in the table.

## Problem 2.2

### Construct a dataset

The dataset `brfss_excellent` is limited to Excellent responses, and contains, year, state, and a variable that averages the data_value across locations within a state. 

```{r}
brfss_excellent <- brfss_smart2010 %>%
  filter(response == "Excellent") %>%
  group_by(year, locationabbr) %>%
  summarize(data_value_avg = mean(data_value)) %>%
  select(year, locationabbr, data_value_avg)
```


### Make a “spaghetti” plot 

This line graph (or spaghetti plot) uses the `brfss_excellent` dataset to display the average data value over time by state.

```{r plot_spaghetti, , warning = FALSE, message = FALSE}
ggplot(brfss_excellent, aes(x = year, y = data_value_avg, color = locationabbr)) + 
  geom_line() + 
  labs(
    title = "Trends over time, by state",
    y = "State average",
    x = "Year"
  ) + 
  theme(legend.position = "none")
```


## Problem 2.3

### First, create the dataset limited to New York State and the years 2006 and 2010.
```{r}
brfss_ny <- brfss_smart2010 %>%
  filter(locationabbr == "NY" & 
           (year == 2006 | year == 2010))
```


### Second, Make a two-panel plot 

This plot shows the distribution of `data_value` for overall health response ratings, from "poor" to "excellent," for the years 2006 and 2010 in New York State.

```{r plot_panels}
ggplot(brfss_ny, aes(x = response, y = data_value)) + 
  geom_boxplot() + 
  facet_grid(~year) + 
  labs(title = "Distributions by Overall Health Response Ratings, 2006 and 2010",
       x = "Rating",
       y = "Value")
```


# Problem 3

In this problem, we will use accelerometer data from 250 participants. The data come from the NHANES study.

Note: Variables `*MIMS` are the MIMS values for each minute of a 24-hour day starting at midnight.

```{r, include=FALSE}
accel <- read_csv("data/nhanes_accel.csv") %>%
  janitor::clean_names()

covar <- read_csv("data/nhanes_covar.csv", 
                  skip = 4) %>%
  janitor::clean_names()
```


## Problem 3.1

Load, tidy, merge, and otherwise organize the data sets. The final dataset includes all originally observed variables; exclude participants less than 21 years of age, and those with missing demographic data; and encode data with reasonable variable classes (i.e. not numeric, and using factors with the ordering of tables and plots in mind).

```{r}

```


## Problem 3.2 

Produce a reader-friendly table for the number of men and women in each education category, and create a visualization of the age distributions for men and women in each education category. Comment on these items.

```{r}

```


## Problem 3.3

Using your tidied dataset, aggregate across minutes to create a total activity variable for each participant. Plot these total activities (y-axis) against age (x-axis); your plot should compare men to women and have separate panels for each education level. Include a trend line or a smooth to illustrate differences. Comment on your plot.

```{r}

```


## Problem 3.4

Accelerometer data allows the inspection activity over the course of the day. Make a three-panel plot that shows the 24-hour activity time courses for each education level and use color to indicate sex. Describe in words any patterns or conclusions you can make based on this graph; including smooth trends may help identify differences.

```{r}

```


